---
title: "P8105 HW3"
output: github_document
date: "2024-10-09"
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(rnoaa)
library(dplyr)
library(ggplot2)
library(readr)
library(janitor)
```

```{r}
library(p8105.datasets)
data("ny_noaa")
```

## Problem 1 

```{r}
ny_noaa_updated = 
  (ny_noaa %>%
mutate(
    date = as.Date(date),
    year = year(date),
    month = month(date),
    day = day(date),  
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin),
    prcp = as.numeric(prcp),
    snow = as.numeric(snow)))
```

In the ny_noaa dataset, we observe weather patterns (precipation, snowfall, snow depth) from numerous stations in New York. The variables identified are: (station) id, date, tmax (max temp in F), tmin (min temp in F), prcp (precipation), and snow (fall). The most commonly observed snowfall values are 0 or NA indicating that there is a large majority of stations that do not have snowfall. 

```{r}
snowfall_values <- ny_noaa_updated %>%
  group_by(snow) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

print(snowfall_values)
```

```{r}
temp_station = ny_noaa_updated %>%
  mutate(month = case_when(
    id == "January" ~ "January",
    id == "July" ~ "July",
    TRUE ~ NA_character_  
  )) 

print(temp_station)
```

## Problem 2 

```{r}
library(tidyverse)
library(haven)
library(janitor)
library(dplyr)

covar_df <- read_csv("./data/nhanes_covar.csv")
accel_df <- read_csv("./data/nhanes_accel.csv")

colnames(covar_df) <- c("SEQN", "sex", "age", "BMI", "education")

covar_df <- covar_df |>
  clean_names()

accel_df <- accel_df |> 
  clean_names()
```

```{r}
covar_df <- covar_df |>
  filter(age >= 21) |>
  drop_na() |>
  mutate(
    sex = 
      case_match(
        sex, 
        1 ~ "male", 
        2 ~ "female"),
    sex = as.factor(sex),
    education= 
      case_match(
        education, 
        1 ~ "Less than high school", 
        2 ~ "High School",
        3 ~ "More than high school"), 
    education = as.factor(education))

accel_df <- accel_df |>
  drop_na()

accel_df = 
  pivot_longer(
    accel_df, 
    starts_with("min"),
    names_to = "minutes", 
    values_to = "min",
    names_prefix = "min")

covar_accel_df = 
  left_join(covar_df, accel_df, by = "seqn")

print(covar_accel_df)
```

For this problem, I used the clean_names function to tidy the data and began to filter the age for the covar_df less than 21 years of age. One thing to note that I am missing in my code is the skip 4 lines function. I did not do this because I had already removed the first 4 rows when I loaded the data into the project. I spoke with someone during office hours and they strongly advised me to not do that for future assignments as I might get deducted points. Hopefully, this clarifies a bit of my work. 

Additionally, I used case_match to sort through the numeric values representing sex to characters. For the accel_df, I used the pivot_longer tool to combine all the columns representing minutes. After that, I combined the two datasets together. 


```{r}
covar_accel_df |>
  group_by(education, sex) |>
  summarize(count = n()) |>
  pivot_wider(names_from = sex, values_from = count) |>
  knitr::kable()
```

```{r}
library(ggridges)

ggplot(covar_accel_df, aes(x = age, fill = sex)) + 
  geom_histogram(binwidth = 5, position = "dodge") + 
  facet_wrap(~ education) +
  labs(title = "Age Distribution by Education Level and Sex", 
       x = "Age", 
       y = "People",
       fill = "Sex") +
  theme_minimal()
```

## Graph 1 

This graph showcases age distribution within each education level: high school, less than high school and more than high school. It compares the difference between two sexes: male and female. Upon observation, we can see that there is an increase of females who pursue education more than high school from the age range 25-35. 

```{r}
activity_df = covar_accel_df |> 
  group_by(seqn) |> 
  summarize(total_activity = sum(min, na.rm = TRUE))

activity_demo_df = left_join(covar_df, activity_df, by = "seqn")

ggplot(activity_demo_df, aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.5) + 
  geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~ education) + 
  labs(title = "Total Daily Activity vs. Age by Education Level and Sex",
       x = "Age", 
       y = "Total Activity", 
       color = "Sex") +
  theme_minimal()
```
## Graph 2 

This graph depicts accelerometer data by education level and sex. Total activity is representing the accelerometer data that we used earlier. From these visualizations, we can see that females have a peak total activity during high school whereas for both sexes, the activity level begans to decrease with age. 


```{r}
library(dplyr)

covar_accel_activity <- covar_accel_df %>%
  mutate(minutes = as.numeric(as.character(minutes)), 
         hour = floor(minutes / 60), 
         hour = ifelse(hour > 23, 23, hour)) %>% 
  group_by(seqn, sex, education, hour) %>% 
  summarize(total_minutes = sum(minutes, na.rm = TRUE), .groups = "drop")

covar_accel_activity |>
  group_by(education, sex, hour) |>
  summarize(mean_total_minutes = mean(total_minutes, na.rm = TRUE), 
            .groups = "drop") |>
  ggplot(aes(x = hour, y = mean_total_minutes, color = sex)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ education, nrow = 3) +
  labs(
    x = "Hour of Day",
    y = "Mean Total Minutes of Activity",
    color = "Sex"
  ) +
  theme_minimal() 
```
This graph took a bit of time to make but essentially I converted the minutes to hour of day to showcase a better visualization when plotting the data. 

## Problem 3 

```{r}
library(tidyverse)
library(readr) 
library(lubridate) 

jan_2020_citibike = 
  read_csv("citibike/Jan 2020 Citi.csv", show_col_types = FALSE) |>
  clean_names() |>
  drop_na() |>
  mutate(Date = "jan 2020")

july_2020_citibike = 
  read_csv("citibike/July 2020 Citi.csv", show_col_types = FALSE) |>
  clean_names() |>
  drop_na() |>
  mutate(Date = "july 2020")

jan_2024_citibike = 
  read_csv("citibike/Jan 2024 Citi.csv", show_col_types = FALSE) |>
  clean_names() |>
  drop_na() |>
  mutate(Date = "jan 2024")

july_2024_citibike = 
  read_csv("citibike/July 2024 Citi.csv", show_col_types = FALSE) |>
  clean_names() |>
  drop_na() |>
  mutate(Date = "july 2024")

citibike_df <- bind_rows(
  jan_2020_citibike, 
  july_2020_citibike, 
  jan_2024_citibike, 
  july_2024_citibike)

citibike_df <- citibike_df %>% 
  filter(duration <= 4 * 60 * 60)

ride_summary <- citibike_df %>% 
  group_by(Date, member_casual) %>% 
  summarize(total_rides = n(), .groups = "drop") %>% 
  pivot_wider(names_from = member_casual, values_from = total_rides) %>% 
  arrange(Date)

knitr::kable(ride_summary, 
             col.names = c("Date", "Casual Riders", "Citi Bike Members"),
             caption = "Total Number of Citi Bike Rides by Year and Month")
```



